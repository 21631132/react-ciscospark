import {
  applyMiddleware,
  compose,
  createStore
} from 'redux';
import thunk from 'redux-thunk';
import Immutable from 'immutable';

/* eslint-disable no-underscore-dangle */
const composeEnhancers
  = typeof window === 'object' &&
  window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__
    ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({
      serialize: {
        immutable: Immutable
      }
    }) : compose;

const middlewares = [thunk];

if (process.env.NODE_ENV !== 'production') {
  const {createLogger} = require('redux-logger'); // eslint-disable-line global-require
  const logger = createLogger({
    level: 'info',
    duration: true,
    collapsed: false,
    logErrors: true
  });
  middlewares.push(logger);
}

const enhancer = composeEnhancers(
  applyMiddleware(...middlewares)
);

export default function initStore(reducers) {
  return createStore(
    reducers,
    enhancer
  );
}
