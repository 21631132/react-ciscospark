import {
  applyMiddleware,
  combineReducers,
  compose,
  createStore
} from 'redux';

import thunk from 'redux-thunk';

import conversation from '@ciscospark/redux-module-conversation';
import activity from '@ciscospark/redux-module-activity';
import flags from '@ciscospark/redux-module-flags';
import indicators from '@ciscospark/redux-module-indicators';
import {reducer as notifications} from '@ciscospark/react-container-notifications';
import share from '@ciscospark/redux-module-share';
import user from '@ciscospark/redux-module-user';
import spark from '@ciscospark/react-redux-spark';
import widget from './reducer';

const devtools = window.devToolsExtension || (() => (noop) => noop);

const middlewares = [thunk];

if (process.env.NODE_ENV !== `production`) {
  const createLogger = require(`redux-logger`); // eslint-disable-line global-require
  const logger = createLogger({
    level: process.env.NODE_ENV === `production` ? `error` : `info`,
    duration: true,
    collapsed: false,
    logErrors: process.env.NODE_ENV === `production`
  });
  middlewares.push(logger);
}

const enhancers = [
  applyMiddleware(...middlewares),
  devtools()
];

export default createStore(
  combineReducers({
    activity,
    conversation,
    flags,
    indicators,
    notifications,
    share,
    user,
    widget,
    spark
  }),
  compose(...enhancers)
);
