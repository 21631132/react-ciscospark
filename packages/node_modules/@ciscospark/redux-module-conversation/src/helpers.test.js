import {filterActivities, normalizeActivity, normalizeActivities} from './helpers';

describe('redux-module-conversation helpers tests', () => {
  let giphyShareActivity, postActivity;
  beforeEach(() => {
    postActivity = {
      id: 'abc-123',
      actor: {},
      object: {
        objectType: 'comment',
        displayName: '11'
      },
      published: 1505420755171,
      verb: 'post',
      url: 'http://activity.url/abc-123',
      mock: true
    };
    giphyShareActivity = {
      id: 'abc-123',
      actor: {},
      object: {
        contentCategory: 'images',
        displayName: '',
        files: {
          items: [
            {
              displayName: 'this is a gif from giphy',
              fileSize: 123456,
              image: {
                height: 180,
                width: 360
              },
              mimeType: 'image/gif',
              objectType: 'file',
              scr: {
                loc: 'https://media1.giphy.com/media/3ohhwimgvkNEFyb2Ao/giphy.gif'
              },
              url: 'https://giphy.com'
            }
          ]
        },
        objectType: 'content'
      },
      published: 1505420755171,
      verb: 'share',
      url: 'http://activity.url/abc-123',
      mock: true
    };
  });

  describe('#filterActivities', () => {
    it('should filter content update activities', () => {
      expect(filterActivities([
        {
          id: 'abc-123',
          object: {
            objectType: 'comment',
            displayName: '11'
          },
          published: 1505420755171,
          url: 'http://activity.url/abc-123',
          mock: true
        },
        {
          id: 'abc-123-filter-me',
          object: {
            objectType: 'content',
            displayName: '11'
          },
          published: 1505420755171,
          url: 'http://activity.url/abc-123',
          verb: 'update',
          mock: true,
          note: 'this should not be in snapshot'
        }
      ])).toMatchSnapshot();
    });

    it('should not filter content activities', () => {
      expect(filterActivities([
        {
          id: 'abc-123',
          object: {
            objectType: 'comment',
            displayName: '11'
          },
          published: 1505420755171,
          url: 'http://activity.url/abc-123',
          mock: true
        },
        {
          id: 'abc-123-dont-filter-me-bro',
          object: {
            objectType: 'content',
            displayName: '11'
          },
          published: 1505420755171,
          url: 'http://activity.url/abc-123',
          verb: 'share',
          mock: true,
          note: 'this should be in snapshot'
        }
      ])).toMatchSnapshot();
    });
  });

  describe('#normalizeActivity', () => {
    it('should not convert a post activity', () => {
      expect(normalizeActivity(postActivity)).toMatchSnapshot();
    });

    it('should convert a giphy share activity', () => {
      expect(normalizeActivity(giphyShareActivity)).toMatchSnapshot();
    });
  });

  describe('#normalizeActivities', () => {
    it('should convert an array of activities', () => {
      expect(normalizeActivities([postActivity, giphyShareActivity])).toMatchSnapshot();
    });
  });
});
