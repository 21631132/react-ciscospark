#!groovy

pipeline {
  agent{
    label 'NODE_JS_BUILDER'
  }

  options {
    timeout(time: 1, unit: 'HOURS')
    timestamps()
    ansiColor('xterm')
  }

  stages {
    stage('Install') {
      steps {
        withCredentials([
          string(credentialsId: 'NPM_TOKEN', variable: 'NPM_TOKEN')
        ]) {
          sh 'echo \'//registry.npmjs.org/:_authToken=${NPM_TOKEN}\' > $HOME/.npmrc'
          sh '''#!/bin/bash -ex
          source ~/.nvm/nvm.sh
          nvm install 7
          nvm use v7
          npm install
          rm -f $HOME/.npmrc
          '''
        }
      }
    }
  }
}
